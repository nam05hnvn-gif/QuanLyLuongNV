{% extends "base_admin.html" %}

{% block title %}Xem lịch sử thay đổi luong{% endblock %}

{% block content %}

<div>

    <h3>Lịch sử thay đổi lương</h3>

    <a href="{% url 'payroll:view_salary' %}">← Quay lại danh sách lương</a>

    <form method="post">
        {% csrf_token %}
        <div>
            <input type="hidden" name="history_id" id="history_id">
            <button type="submit">Xóa</button>
        </div>
    </form>

    <div>
        <div>
            <table border="1" cellspacing="0" cellpadding="5">
                <thead>
                    <tr>
                        <th></th>
                        <th>Thứ tự</th>
                        <th>Mã lương</th>
                        <th>Hạng</th>
                        <th>Số tiền</th>
                        <th>Hệ số</th>
                        <th>Thời điểm thay đổi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for h in histories %}
                    <tr class="clickable-row">
                        <td><input type="radio" name="history_id" value="{{ h.history_id }}"></td>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ h.salary_id }}</td>
                        <td>{{ h.old_rank }} -> {{ h.new_rank }}</td>
                        <td>{{ h.old_amount }} -> {{ h.new_amount }}</td>
                        <td>{{ h.old_multiplier }} -> {{ h.new_multiplier }}</td>
                        <td>{{ h.change_date|date:"d/m/Y H:i:s" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9">Không có lịch sử thay đổi nào.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<script>
// Khi click vào <tr>, check radio bên trong
document.querySelectorAll('.clickable-row').forEach(row => {
    row.addEventListener('click', function(e){
        // Nếu click vào chính radio, bỏ qua
        if(e.target.type !== 'radio'){
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;
        }

        // Bỏ màu các dòng khác
        document.querySelectorAll('.clickable-row').forEach(r => r.classList.remove('table-primary'));

        // Tô màu dòng đang chọn
        this.classList.add('table-primary');

        // Gán ID vào input hidden để gửi form
        const selectedId = this.querySelector('input[type="radio"]').value;
        document.getElementById('history_id').value = selectedId;
    });
});
</script>

{% endblock %}
