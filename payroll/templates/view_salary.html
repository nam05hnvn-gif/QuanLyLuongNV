{% extends "base_admin.html" %}

{% block title %}Bảng lương{% endblock %}

{% block content %}
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <div class="container my-5">
        <h1 class="mb-4 text-center">Bảng lương</h1>

        <!-- Form sửa (ẩn nếu chưa chọn) -->
        {% if edit_salary %}
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">Sửa mức lương: {{ edit_salary.salary_id }}</div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="salary_id" value="{{ edit_salary.salary_id }}">
                    <div class="mb-3">
                        <label>Cấp bậc lương</label>
                        <input type="text" name="salary_rank" class="form-control" value="{{ edit_salary.salary_rank }}" required>
                    </div>
                    <div class="mb-3">
                        <label>Mức lương</label>
                        <input type="number" name="amount" class="form-control" value="{{ edit_salary.amount }}" required>
                    </div>
                    <div class="mb-3">
                        <label>Hệ số</label>
                        <input type="number" name="multiplier" class="form-control" step="0.01" value="{{ edit_salary.multiplier }}" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                </form>
            </div>
        </div>
        {% endif %}

<!-- ----------------------------------------------------------------- -->

    <div class="d-flex justify-content-end mb-3 gap-2">
        <a href="{% url 'payroll:view_history_salary' %}" class="btn btn-outline-dark">
            Xem lịch sử thay đổi
        </a>
        <a href="{% url 'payroll:add_salary' %}" class="btn btn-success">Thêm mức lương mới</a>
        <form id="editForm" method="get">
            <input type="hidden" name="salary_id" id="salary_id">
        <button type="submit" class="btn btn-primary">Sửa mức lương</button>
    </form>
    </div>
        <div class="table-responsive">
            <table class="table table-bordered table-hover table-striped align-middle text-center">
                <thead class="table-dark">
                    <tr>
                        <th></th>
                        <th>ID</th>
                        <th>Chức vụ</th>
                        <th>Lương</th>
                        <th>Hệ số lương</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in salary %}
                    <tr class="clickable-row">
                        <td>
                            <input type="radio" name="selected_id" value="{{ s.salary_id }}">
                        </td>
                        <td>{{ s.salary_id }}</td>
                        <td>{{ s.rank }}</td>
                        <td>{{ s.amount|floatformat:0 }}</td>
                        <td>{{ s.multiplier }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4">Chưa có dữ liệu</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
    </div>


    <!-- Bootstrap JS Bundle CDN (optional, cho các component JS) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- tÔ ĐẬM KHI SELECT-->
<script>
// Khi click vào <tr>, check radio bên trong
document.querySelectorAll('.clickable-row').forEach(row => {
    row.addEventListener('click', function(e){
        // Nếu click vào chính radio, bỏ qua
        if(e.target.type !== 'radio'){
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;
        }

        // Thêm class tô màu cho dòng được chọn
        document.querySelectorAll('.clickable-row').forEach(r => r.classList.remove('table-primary'));
        this.classList.add('table-primary');

        const selectedId = this.querySelector('input[type="radio"]').value;
        document.getElementById('salary_id').value = selectedId;
    });
});
</script>

{% endblock %}